<html>
  <head>
    <title>Chat</title>
    <style>

      input { display: block; }
      ul    { list-style: none; }
      .tabrow td div { width: 100%; }

    </style>
  </head>
      

  <body>
    <form id="dl">
      <textarea></textarea>
      <input type="submit" value="Download" />
    </form>
    
    <table id="table1">
      <thead>
          <tr>
              <th>Extension</th>
              <th>Resolution</th>
              <th>VideoEncoding</th>
              <th>AudioEncoding</th>
              <th>AudioBitrate</th>                                                        
          </tr>
      </thead>
      <tbody></tbody>
  </table>   

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>

    <script>

        $(function(){
          var url = $("#dl textarea");
          var messages = $("#messages");

          $("body").on("click",".editrow",function(ev){
            var index = $("tr"). index($(this).parents(".tabrow")); 

            console.log("index="+index);
            $.ajax({
                url: '/download/'+btoa(url.val())+'/'+(index - 1),
                type: 'GET',
                async: false,
                success: function(data){ 
                  alert("success");
                },
                error: function(data) {
                    alert('woops!'); //or whatever
                }
            });            

          });          

          $("#dl").submit(function(e){
            e.preventDefault();
            if (!url.val()) return false;
            var encodedUrl = btoa(url.val());

            $.ajax({
                url: '/info/'+encodedUrl,
                type: 'GET',
                async: false,
                success: function(data){ 
                    $.each(data.Formats, function(i, row){
                      var newRow =
                        "<tr class='tabrow'>"
                        +"<td>"+row.Extension+"</td>"
                        +"<td>"+row.Resolution+"</td>"
                        +"<td>"+row.VideoEncoding+"</td>"
                        +"<td>"+row.AudioEncoding+"</td>"
                        +"<td>"+row.AudioBitrate+"</td>"
                        +"<td> <a href='/download/"+encodedUrl+"/"+ i +"' >download</a> </td>"
                        +"</tr>" ;
                        $(newRow).appendTo("#table1 tbody");
                    });
                },
                error: function(data) {
                    alert('woops!'); //or whatever
                }
            });            
          });
        })

    </script>

  </body>
</html>